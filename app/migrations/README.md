# Database Migrations

This directory contains the database migrations managed with Alembic.

Migrations allow versioning and applying structural changes to the
database in a controlled and reproducible way.

------------------------------------------------------------------------

## Structure

    migrations/
    │
    ├── env.py          # Alembic environment configuration
    ├── script.py.mako  # Template used to generate new migration files
    └── versions/       # Generated migration revisions

-   **env.py**: Configures the database connection and migration
    context.
-   **versions/**: Contains the versioned migration files.
-   **script.py.mako**: Template used when generating new revisions.

------------------------------------------------------------------------

## Running Migrations

Apply all pending migrations:

    alembic upgrade head

Apply a specific revision:

    alembic upgrade <revision_id>

Revert the last migration:

    alembic downgrade -1

------------------------------------------------------------------------

## Creating a New Migration

Autogenerated migration based on model changes:

    alembic revision --autogenerate -m "Describe the change"

Create an empty migration:

    alembic revision -m "Describe the change"

------------------------------------------------------------------------

## Configuration

The database connection is obtained from the environment variable:

    DATABASE_URL

Example:

    postgresql+psycopg2://user:password@postgres:5432/hwc_db

When running inside Docker, the host must be the service name (e.g.,
`postgres`) instead of `localhost`.

------------------------------------------------------------------------

## Docker Integration

Migrations are executed automatically when the container starts via the
configured entrypoint.

It is not necessary to run them manually when starting the project with:

    docker compose up

------------------------------------------------------------------------

## Best Practices

-   Do not modify migrations that have already been applied in
    production.
-   Always review autogenerated migrations before committing.
-   Keep migrations small and focused.
-   Use clear and descriptive revision messages.
